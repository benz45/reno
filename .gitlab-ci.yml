include:
  - local: /.gitlab-ci/test.gitlab-ci.yml
  - local: /.gitlab-ci/package.gitlab-ci.yml
  - local: /.gitlab-ci/build.gitlab-ci.yml
  - local: /.gitlab-ci/checkout.gitlab-ci.yml
  - local: /.gitlab-ci/deploy.gitlab-ci.yml

.alpine-base:
  image: alpine:3.16

.aws-base:
  image: registry.gitlab.com/gitlab-org/cloud-deploy/aws-base:latest

.mvn-base:
  image: maven:3-jdk-11

.ssh:
  extends: .alpine-base
  before_script:
    - apk update && apk add openssh
    - mkdir -p ~/.ssh
    - chmod 700 ~/.ssh
    - ssh-keyscan $AWS_SERVER_IP >> ~/.ssh/known_hosts
    - chmod 644 ~/.ssh/known_hosts
    - chmod 0400 main.pem

stages:
  - Test
  - Package
  - Build
  - Checkout
  - Deploy
